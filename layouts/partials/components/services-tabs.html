{{/* layouts/partials/components/services-tabs.html */}}
{{ $categories := sort .Site.Data.services.categories "weight" }}
<section class="services-tabs">
    <div class="main-container">
        <div id="tabs-nav" class="tabs-container">
            <div id="active-tab-indicator" class="active-tab-indicator"></div>
            {{ range $categories }}
                <button data-tab="{{ .key }}" class="tab-button">{{ .name }}</button>
            {{ end }}
        </div>

        <div class="services-tabs__grid">
            <!-- Left: Service List Container -->
            <div class="services-tabs__nav-column">
                {{ range $categories }}
                    <nav id="{{ .key }}-services" class="service-list">
                        {{/* Create a slice to preserve service keys before sorting */}}
                        {{ $servicesSlice := slice }}
                        {{ range $serviceKey, $serviceData := .services }}
                            {{ $servicesSlice = $servicesSlice | append (dict "key" $serviceKey "data" $serviceData) }}
                        {{ end }}
                        
                        {{ $sortedServices := sort $servicesSlice "data.weight" }}

                        {{ range $sortedServices }}
                            <button data-panel="{{ .key }}" class="service-button">
                                <span class="service-button__title">{{ .data.type }}</span>
                                <span class="service-button__tagline">{{ .data.tagline }}</span>
                            </button>
                        {{ end }}
                    </nav>
                {{ end }}
            </div>

            <!-- Right: Details Panel Container -->
            <div class="details-container">
                {{ range $categories }}
                    {{ $categoryKey := .key }}
                    {{ range $serviceKey, $serviceData := .services }}
                        {{ $context := dict "serviceKey" $serviceKey "serviceData" $serviceData "categoryKey" $categoryKey }}
                        {{ partial "components/services/service-detail-panel.html" $context }}
                    {{ end }}
                {{ end }}
            </div>
        </div>
    </div>
</section>
